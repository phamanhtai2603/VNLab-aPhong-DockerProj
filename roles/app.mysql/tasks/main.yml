---

- name: make build dir
  file:
    dest="{{ user_home }}/mysql"
    owner="{{process_execution_user}}"
    group="{{process_execution_user}}"
    state=directory

- name: make data store dir
  file:
    dest="{{ user_home }}/mysql/db_data"
    owner="{{process_execution_user}}"
    group="{{process_execution_user}}"
    state=directory

- name: copy docker_compose file
  template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    owner: "{{process_execution_user}}"
    group: "{{process_execution_user}}"
  with_items:
    - { src: "docker-compose.yml", dest: "{{ user_home }}/mysql/docker-compose.yml" }

- name: docker-compose restart
  become_user: "{{ process_execution_user }}"
  command: "{{ item }}"
  args:
    chdir: "{{ user_home }}/mysql"
  with_items:
    - "docker-compose down"
    - "docker-compose up -d"
